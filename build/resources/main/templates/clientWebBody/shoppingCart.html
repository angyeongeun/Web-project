<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
>
<head>
    <meta charset="UTF-8">
    <title>MyPage</title>

    <header th:replace="clientWeb/header :: headerFragment"></header>

</head>
<body>

<!--section부분 / what's in my bag-->
<th:block th:include="clientWeb/wmSection.html"></th:block>
<!--section부분-->


<!-- Blog Details Section Begin -->
<section class="blog-details spad">
    <div class="container">
        <div class="row">

            <th:block th:include="clientWeb/mypageSidebar.html"></th:block>

            <div class="col-lg-8 col-md-7 order-md-1 order-1">
                <!--Section: Block Content-->
                <section>

                    <!--Grid row-->
                    <div class="row">

                        <!--Grid column-->
                        <div class="col-lg-8">

                            <!-- Card -->
                            <div class="card wish-list mb-3">
                                <br>
                                <h5 align="center" class="mb-4">Cart (<span>Ajax하기</span> n개 items)</h5>

                                <input type="hidden" id="firstCartId" value="${'firstCartId'}"/>
                                <input type="hidden" id="lastCartId" value="${lastCartId}"/>

                                <!--여기서부터 for each로 돌려서 장바구니 추가되게 해야함-->
                                <div class="card-body" th:each="cart : ${cartList}">

                                    <article id="cart"

                                             th:data-name="${cart.productName}"
                                             th:data-price="${cart.productPrice}"
                                             th:data-image="${cart.image}"
                                             th:data-userEmail="${cart.userEmail}"
                                             th:data-amount="${cart.amount}"
                                    />
                                    <!--데이터를 자바스크립으로 보내기-->
                                    <!--<input type="hidden" class="cartData"
                                       th:data-id="${cart.cartId}"
                                       th:data-name="${cart.productName}"
                                       th:data-price="${cart.productPrice}"
                                       th:data-image="${cart.image}"
                                       th:data-userEmail="${cart.userEmail}"
                                       th:data-amount="${cart.amount}"
                                    >&lt;!&ndash;!--데이터를 자바스크립으로 보내기-->

                                    <div class="row mb-4">
                                        <div class="col-md-5 col-lg-3 col-xl-3">
                                            <div class="view zoom overlay z-depth-1 rounded mb-3 mb-md-0">
                                                <input type="checkbox" class="chBox"
                                                       checked
                                                       th:id="cartNum+${cart.cartId}"
                                                       th:data-id="${cart.cartId}"
                                                >
                                                <img th:src="@{'/img/product/'+${cart.image}}">
                                            </div>
                                        </div>
                                        <div class="col-md-7 col-lg-9 col-xl-9">
                                            <div>
                                                <div class="d-flex justify-content-between">
                                                    <div>
                                                        <span th:text="${cart.store}"/><br>
                                                        <h5><span th:text="${cart.productName}"/></h5>
                                                        <!--                                                        <p class="mb-3 text-muted text-uppercase small">Shirt - blue</p>
                                                                                                                <p class="mb-2 text-muted text-uppercase small">Color: blue</p>
                                                                                                                <p class="mb-3 text-muted text-uppercase small">Size: M</p>-->
                                                    </div>
                                                    <div>
                                                        <div class="def-number-input number-input safari_only mb-0 w-100">

                                                            <div class="pro-qty">

                                                                <input type="text" class="amount" value="1">

                                                            </div>
                                                            <!--                                                            <button style="width:10pt;height:10pt;" class="minus"
                                                                                                                                onclick="this.parentNode.querySelector('input[type=number]').stepDown()"
                                                                                                                                th:onclick="|javascript:calc('${cart.productPrice}')|"
                                                                                                                        ></button>
                                                                                                                        <input class="quantity"  min="0"  id="quantity" name="quantity" value="1" type="number">
                                                                                                                        <button style="width:10pt;height:10pt;"
                                                                                                                                class="plus"></button>-->
                                                        </div>

                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <a href="#!" type="button"
                                                           class="card-link-secondary small text-uppercase mr-3"><i
                                                                class="fas fa-trash-alt mr-1"></i> 장바구니에서 빼기 </a>
                                                    </div>
                                                    <p class="mb-0"><span><strong>
                                                        <input type="hidden" class="productPrice"
                                                               th:value="${cart.productPrice}">
                                                        <span th:align="center" th:text="${cart.productPrice}"/>
                                                    </strong></span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!--여기까지 for each 돌릴 문장임-->


                            </div>
                            <!-- Card -->


                        </div>
                        <!--Grid column-->

                        <!--Grid column-->
                        <div class="col-lg-4">

                            <!-- Card -->
                            <div class="card mb-3">
                                <div class="card-body">

                                    <h5 class="mb-3">The total amount of</h5>

                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                                            물품 가격
                                            <span id="productTot">0</span>원
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                            배달비
                                            <span>5000원</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                                            <div>
                                                <strong>총 결제금액</strong>
                                            </div>
                                            <span><strong id="payTot">5000</strong></span>원
                                        </li>
                                    </ul>

                                    <button type="button" id="payBtn"
                                            class="btn btn-success btn-block waves-effect waves-light">결제하기
                                    </button>

                                </div>
                            </div>
                            <!-- Card -->


                        </div>
                        <!--Grid column-->

                    </div>
                    <!--Grid row-->

                </section>
                <!--Section: Block Content-->
            </div>


        </div>


    </div>
    </div>
    </div>

</section>


<footer th:replace="clientWeb/footer :: footerFragment"></footer>
<script type="text/javascript" th:inline="javascript">

    var payTot;
    var tot = 0;
    var cartList = [[${cartList}]];
    var firstCartId = cartList[0].cartId;
    var lastCartId = cartList[cartList.length-1].cartId;

    $(document).ready(function () {
        for (i = 0; i < cartList.length; i++) {
            /*          alert(cartList[i].productName);*/
            tot += (cartList[i].productPrice * cartList[i].amount); //
            //alert(tot);
        }

        payTot = tot + 5000;

        //alert($(this).data('cartId'));

        //total amount of에 뿌리기
        $('#productTot').text(tot);

        $('#payTot').text(payTot);


        $('.dec').click(function () {
            //alert('물품 감소');

        });

        $('.inc').click(function () {
            //alert('물품 증가');

        });


        $('#chBox').click(function () {
//            alert($('#chBox').data('cartId'));
        });


//결제버튼
        $('#payBtn').click(function () {
            swal('주문서 제출 성공!','','success');
            //1. 체크박스만 추출
            var checkArr = new Array();
//        alert(lastCartId.length+"카트 길이");
            var i ;
            for (i = firstCartId; i <= lastCartId; i++) {
                // var chBox = document.getElementById('cartNum' + (i + 1));
                //alert(document.getElementById('cartNum' + (i + 1)).dataset.id) ;
                checkArr.push(document.getElementById('cartNum'+i).dataset.id);

                /*if($("input:checkbox[name='cartNum'+"+i+"]").is(":checked") == true) {

            }*/
            }
//            var article = document.getElementById('cart');
            /*            $("input[class='chBox']:checked").each(function () {

                            alert(chBox.dataset.id) ;
            //                alert(article.dataset.name) ;

                        });*/

            //2.DB에 주문서 저장



            $.ajax({
                url: "/clientWeb/pushOrder",
                data: {chbox: checkArr},
                type: "POST",
                //dataType: "json",

                success: function () {
                   //swal('주문서 제출 성공!', '', 'success');
                    location.href='/shoppingCart';
                    //이거 수정해야함. 페이지를 다시 안불러옴
                }
            });





        });//결제 버튼
    });



</script>


</body>
</html>